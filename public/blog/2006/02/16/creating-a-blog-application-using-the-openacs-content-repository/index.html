
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Creating a Blog Application using the OpenACS Content Repository - Vinod Kurup</title>
  <meta name="author" content="Vinod Kurup">

  
  <meta name="description" content="I created a very simple blog application using the OpenACS Content Repository (CR). When I say simple, I mean simple, probably to the point of being &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://www.kurup.org/blog/2006/02/16/creating-a-blog-application-using-the-openacs-content-repository">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/vkurup" rel="alternate" title="Vinod Kurup" type="application/atom+xml">
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='//fonts.googleapis.com/css?family=Quattrocento' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Quattrocento+Sans' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>

<meta name="verify-v1" content="7VLvj7jbZMA24/73SZ9uUEq3SeBuiX3+aSIBRtgH4jQ=" />
<link rel="openid.server" href="http://www.myopenid.com/server" />
<link rel="openid.delegate" href="http://vkurup.myopenid.com/" />
<link rel="openid2.local_id" href="http://vkurup.myopenid.com/" />
<link rel="openid2.provider" href="http://www.myopenid.com/server" />
<meta http-equiv="X-XRDS-Location" content="http://www.myopenid.com/xrds?username=vkurup.myopenid.com" />

<link href="/favicon.ico" rel="shortcut icon" />

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-79447-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Vinod Kurup</a></h1>
  
    <h2>Hospitalist/programmer in search of the meaning of life</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/vkurup" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.kurup.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/about.html">About Me</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories">Categories</a></li>
  <li><a href="/medicine">Medicine</a></li>
  <li><a href="/running">Running</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Creating a Blog Application Using the OpenACS Content Repository</h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-02-16T00:00:00-05:00" pubdate data-updated="true">Feb 16<span>th</span>, 2006</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I created a very simple blog application using the OpenACS Content Repository (CR). When I say simple, I mean simple, probably to the point of being useless. I just wanted to try writing something as quickly as possible using the CR. Here&#8217;s a quick run-through of the code, in case it might help someone else understand how to use the CR. I&#8217;m not including much commentary; email me (or comment) if you&#8217;d like me to expound more.</p>

<h4>blog.info</h4>

<pre><code>&lt;?xml version="1.0"?&gt; 
&lt;!-- Generated by the OpenACS Package Manager --&gt;  
&lt;package key="blog" url="http://openacs.org/repository/apm/packages/blog" type="apm_application"&gt;   
  &lt;package-name&gt;Blog&lt;/package-name&gt;
  &lt;pretty-plural&gt;Blogs&lt;/pretty-plural&gt;
  &lt;initial-install-p&gt;f&lt;/initial-install-p&gt;
  &lt;singleton-p&gt;f&lt;/singleton-p&gt;
  &lt;version name="0.1d" url="http://openacs.org/repository/download/apm/blog-0.1d.apm"&gt;
    &lt;owner url="mailto:admin@localhost"&gt;Admin User&lt;/owner&gt;
    &lt;summary&gt;A blog application.&lt;/summary&gt;
    &lt;description format="text/html"&gt;A simple Blog application using the Content Repository.&lt;/description&gt;
    &lt;maturity&gt;0&lt;/maturity&gt;
    &lt;provides url="blog" version="0.1d"/&gt;
    &lt;requires url="acs-content-repository" version="5.2.2"/&gt;
    &lt;callbacks&gt;
      &lt;callback type="after-install"  proc="blog::apm::after_install"/&gt;
      &lt;callback type="after-instantiate"  proc="blog::apm::after_instantiate"/&gt;
      &lt;callback type="before-uninstantiate"  proc="blog::apm::before_uninstantiate"/&gt;
      &lt;callback type="before-uninstall"  proc="blog::apm::before_uninstall"/&gt;
    &lt;/callbacks&gt;
    &lt;parameters&gt;
      &lt;!-- No version parameters --&gt;
    &lt;/parameters&gt;
  &lt;/version&gt;
&lt;/package&gt;
</code></pre>

<h4>tcl/blog-apm-procs.tcl</h4>

<pre><code>namespace eval blog::apm {}

ad_proc -private blog::apm::after_install {} {
    Install the blog datamodel. 
} {     
    content::type::new -content_type blog_post \
        -pretty_name "Blog Post" \
        -pretty_plural "Blog Posts" \
        -table_name "cr_blog_posts" \
        -id_column "post_id" 
}  

ad_proc -private blog::apm::after_instantiate { -package_id } {
    Setup one instance of a blog. Creates a content folder and associate
    blog_posts with it. 
} {
    set folder_id [content::folder::new \
                       -name $package_id \
                       -label "Blog Folder $package_id" \
                       -package_id $package_id \
                       -context_id $package_id]

    content::folder::register_content_type \
        -folder_id $folder_id \
        -content_type "blog_post" \
        -include_subtypes "t" 
}  

ad_proc -private blog::apm::before_uninstantiate { -package_id } {
    Remove 1 instance of blog application. 
} {
    set folder_id [blog::folder_id $package_id]
    content::folder::delete -folder_id $folder_id -cascade_p t
    content::type::delete -content_type blog_post \
        -drop_children_p t \
        -drop_table_p t 
}  

ad_proc -private blog::apm::before_uninstall {} {
    Drop the application. 
} {
    content::type::delete -content_type blog_post \
        -drop_children_p t \
        -drop_table_p t 
} 
</code></pre>

<h4>tcl/blog-procs.tcl</h4>

<pre><code>namespace eval blog {}

ad_proc -public blog::folder_id {package_id} {
    Return the CR folder_id associated with this package_id
    @param package_id Current package_id 
} {
    return [db_string get_folder_id "select folder_id from cr_folders where package_id=:package_id"] 
}
</code></pre>

<h4>www/index.tcl</h4>

<pre><code>ad_page_contract {
    List posts
    @author Vinod Kurup [vinod@kurup.com]
    @creation-date Tue Feb 14 20:56:24 2006
    @cvs-id $Id:$ 
} { 
} {
    set package_id [ad_conn package_id]
    db_multirow posts posts "
    select i.item_id,
           r.title,
           r.content,
           to_char(o.creation_date,'YYYY-MM-DD HH24:MI:SS') as creation_date,
           o.creation_user
     from cr_blog_posts p, cr_items i, cr_revisions r, acs_objects o
    where i.item_id=o.object_id
      and p.post_id=r.revision_id
      and o.package_id=:package_id
       and i.live_revision=p.post_id
    order by creation_date desc"
} 
</code></pre>

<h4>www/index.adp</h4>

<pre><code>&lt;master&gt;
  &lt;p&gt;&lt;a href="post/ae"&gt;Add Post&lt;/a&gt;&lt;/p&gt;
  &lt;multiple name="posts"&gt;
    &lt;include src="../lib/one-post"
             item_id="@posts.item_id@"
             title="@posts.title@"
             content="@posts.content@"
             creation_user="@posts.creation_user@"
             creation_date="@posts.creation_date@"
             /&gt;
  &lt;/multiple&gt;
</code></pre>

<h4>www/post/ae.tcl</h4>

<pre><code>ad_page_contract {
      Add or edit a post
      @author Vinod Kurup [vinod@kurup.com]
      @creation-date Tue Feb 14 20:39:39 2006
      @cvs-id $Id:$ 
} {
    item_id:integer,optional 
} {
    set package_id [ad_conn package_id]
    set user_id [ad_conn user_id]
    set ip_addr [ad_conn peeraddr]
    permission::require_permission -object_id $package_id -privilege write
    set context [list "Add/Edit Post"]

    ad_form -name add_post -form {
        item_id:key(t_acs_object_id_seq)
        title:text(text)
        content:text(textarea) 
    } -select_query {
        select r.title, r.content
        from cr_items i, cr_revisions r
        where i.item_id=:item_id
        and i.live_revision=r.revision_id 
    } -edit_data {
        content::revision::new -item_id $item_id \
            -title $title \
            -content $content \
            -package_id $package_id \
            -is_live t

        ns_returnredirect .. 
    } -new_data {
        content::item::new -name "Post $item_id" \
            -item_id $item_id \
            -creation_user $user_id \
            -text $content \
            -package_id $package_id \
            -parent_id [blog::folder_id $package_id] \
            -creation_ip $ip_addr \
            -content_type "blog_post" \
            -title $title

        ns_returnredirect .. 
    }
</code></pre>

<h4>www/post/ae.adp</h4>

<pre><code>&lt;master&gt;
  &lt;property name="title"&gt;Add/Edit Post&lt;/property&gt;
  &lt;property name="context"&gt;@context;noquote@&lt;/property&gt;

  &lt;formtemplate id="add_post"&gt;&lt;/formtemplate&gt;
</code></pre>

<h4>www/post/del.tcl</h4>

<pre><code>ad_page_contract {
    Delete a post
    @author Vinod Kurup [vinod@kurup.com]
    @creation-date Tue Feb 14 22:49:11 2006
    @cvs-id $Id:$ 
} {
    item_id:integer 
} {
    permission::require_permission -object_id $item_id -privilege write
    content::item::delete -item_id $item_id
    ns_returnredirect .. 
}
</code></pre>

<h4>www/post/view.tcl</h4>

<pre><code>ad_page_contract {
    View one post
    @author Vinod Kurup [vinod@kurup.com]
    @creation-date Wed Feb 15 20:24:32 2006
    @cvs-id $Id:$ 
} {
    item_id:integer 
} {
    set package_id [ad_conn package_id] 
    set package_url [ad_conn package_url]
    db_0or1row post " select i.item_id,
        r.title,
        r.content,
        to_char(o.creation_date,'YYYY-MM-DD HH24:MI:SS') as creation_date,
        o.creation_user
   from cr_blog_posts p, cr_items i, cr_revisions r, acs_objects o
  where i.item_id=o.object_id
    and p.post_id=r.revision_id
    and o.package_id=:package_id
     and i.live_revision=p.post_id
    and i.item_id=:item_id"

    set context [list $title] 
</code></pre>

<h4>www/post/view.adp</h4>

<pre><code>&lt;master&gt;
  &lt;property name="context"&gt;@context;noquote@&lt;/property&gt;
  &lt;property name="title"&gt;@title@&lt;/property&gt;

  &lt;include src="../../lib/one-post"
           item_id="@item_id@"
           title="@title@"
           content="@content@"
           creation_user="@creation_user@"
           creation_date="@creation_date@"
           /&gt;
</code></pre>

<h4>lib/one-post.tcl</h4>

<pre><code>set package_url [ad_conn package_url]
set now [clock format [clock seconds] -format "%Y-%m-%d %H:%M:%S"]
set creation_date_pretty [util::age_pretty \
                              -timestamp_ansi $creation_date \
                              -sysdate_ansi $now]
set author [acs_community_member_link -user_id $creation_user]
set write_p [permission::permission_p -object_id $item_id -privilege write]
set perm_url [export_vars -base "${package_url}post/view" {item_id}]
</code></pre>

<h4>lib/one-post.adp</h4>

<pre><code>&lt;div class="post"&gt;
  &lt;h2&gt;&lt;a href="@perm_url@"&gt;@title@&lt;/a&gt;&lt;/h2&gt;
  &lt;p class="byline"&gt;
    Posted by @author;noquote@
    &lt;span class="date"&gt;@creation_date_pretty@&lt;/span&gt;
  &lt;/p&gt;
  &lt;div class="content"&gt;
    @content;noquote@
  &lt;/div&gt;
  &lt;p class="actions"&gt;
    &lt;if @write_p@&gt;
      &lt;a href="@package_url@post/ae?item_id=@item_id@"&gt;Edit&lt;/a&gt; |
      &lt;a href="@package_url@post/del?item_id=@item_id@"&gt;Delete&lt;/a&gt;
    &lt;/if&gt;
  &lt;/p&gt;
&lt;/div&gt;
</code></pre>

<h4>Notes</h4>

<p>You&#8217;ll notice that there are no SQL datamodel files. Since I&#8217;m using the CR, all of the datamodel is created by using the CR TCL API (specifically content::type::new). This package is subsite aware meaning you can install apps on multiple subsites and the data in each subsite will remain isolated from other subsites. It should uninstall itself cleanly since I&#8217;ve written callbacks for before-uninstantiate and before-uninstall.</p>

<p>Like I said, this is very simplistic. You can create, read, update and delete posts, but that&#8217;s about it. No commenting. No tags or categories. No RSS feeds. No search. But, since we&#8217;ve used the CR as our base, I think it would be very easy to extend the app to do all those things. I&#8217;m going to work on that, just for fun, of course. Thanks to <a href="http://www.thedesignexperience.org">Dave Bauer</a> for writing the TCL interface to the CR and for writing the wiki package which made me see the light about the benefits of using the CR.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Vinod Kurup</span></span>

      








  


<time datetime="2006-02-16T00:00:00-05:00" pubdate data-updated="true">Feb 16<span>th</span>, 2006</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/blog/'>blog</a>, <a class='category' href='/blog/categories/openacs/'>openacs</a>, <a class='category' href='/blog/categories/programming/'>programming</a>, <a class='category' href='/blog/categories/web/'>web</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="https://www.kurup.org/blog/2006/02/16/creating-a-blog-application-using-the-openacs-content-repository" data-via="vkurup" data-counturl="https://www.kurup.org/blog/2006/02/16/creating-a-blog-application-using-the-openacs-content-repository" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2006/02/14/friendship" title="Previous Post: Friendship">&laquo; Friendship</a>
      
      
        <a class="basic-alignment right" href="/blog/2006/02/17/pound-update-kills-my-website" title="Next Post: Pound update kills my website">Pound update kills my website &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/09/22/starting-a-garden">Starting a garden</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/05/31/indian-civilization">History of Indian Civilization</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/05/30/autovacuum-fail">Autovacuum not running</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/05/29/renaissance-man">Renaissance Man</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/28/cbv-dynamic">Using dynamic queries in a CBV</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/23/some-emacs-posts">Some Emacs Posts</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/22/pygments-py3">Pygments on Arch Linux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/21/django-test-models">How to create test models in Django</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/21/peanut-allergy-a-personal-clinical-review">Peanut Allergy, a personal clinical review</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/17/priorities-and-gtd">Priorities and GTD</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/16/gtd-again">GTD again?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/15/writing-paralysis">Writing paralysis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/09/steal-my-web-app-idea">Steal My Web App Idea</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/30/how-to-change-the-rear-tire-on-a-12-inch-bicycle">How to change the rear tire on a 12 inch bicycle</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/05/nsbrief-gets-the-best-guests">NSBrief gets the best guests</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/24/emacs-for-python-programming">Emacs for Python Programming</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/15/emacs-autocomplete-stumbles-on-yasnippet">Emacs Autocomplete stumbles on yasnippet</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/14/ive-gone-to-the-dark-side">I've gone to the dark side</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/04/avik-arrives">Avik Arrives!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/21/thoughts-on-free-will">Thoughts on Free Will</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("vkurup", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/vkurup" class="twitter-follow-button" data-show-count="true">Follow @vkurup</a>
  
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:vkurup">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "vkurup"; //id target for pinboard list
  var pinboard_count = 10; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  <a rel="license"
  href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Some rights
  reserved</a> by <a rel="author" href="https://profiles.google.com/vvkurup/" title="View my Google Profile">Vinod Kurup</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'vkurup';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
