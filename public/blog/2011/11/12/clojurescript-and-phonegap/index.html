
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ClojureScript and PhoneGap - Vinod Kurup</title>
  <meta name="author" content="Vinod Kurup">

  
  <meta name="description" content="Phonegap is a tool that allows you to develop
apps in HTML5 + javascript and makes it easy to deploy them to
multiple mobile platforms, including &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://www.kurup.org/blog/2011/11/12/clojurescript-and-phonegap">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/vkurup" rel="alternate" title="Vinod Kurup" type="application/atom+xml">
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='//fonts.googleapis.com/css?family=Quattrocento' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Quattrocento+Sans' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>

<meta name="verify-v1" content="7VLvj7jbZMA24/73SZ9uUEq3SeBuiX3+aSIBRtgH4jQ=" />
<link rel="openid.server" href="http://www.myopenid.com/server" />
<link rel="openid.delegate" href="http://vkurup.myopenid.com/" />
<link rel="openid2.local_id" href="http://vkurup.myopenid.com/" />
<link rel="openid2.provider" href="http://www.myopenid.com/server" />
<meta http-equiv="X-XRDS-Location" content="http://www.myopenid.com/xrds?username=vkurup.myopenid.com" />

<link href="/favicon.ico" rel="shortcut icon" />

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-79447-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Vinod Kurup</a></h1>
  
    <h2>Hospitalist/programmer in search of the meaning of life</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/vkurup" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.kurup.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/about.html">About Me</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories">Categories</a></li>
  <li><a href="/medicine">Medicine</a></li>
  <li><a href="/running">Running</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">ClojureScript and PhoneGap</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-12T21:39:34-05:00" pubdate data-updated="true">Nov 12<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><a href="http://phonegap.com">Phonegap</a> is a tool that allows you to develop
apps in HTML5 + javascript and makes it easy to deploy them to
multiple mobile platforms, including Android and iOS.</p>

<p><a href="https://github.com/clojure/clojurescript">ClojureScript</a> is a dialect
of the awesome language, <a href="http://clojure.org">Clojure</a>, that compiles to
Javascript (after a pass through the <a href="http://code.google.com/closure/">Google
Closure</a> optimizer). Because Clojure,
ClojureScript and Google Closure can be confusing terms, I&#8217;ll use CLJS
instead of ClojureScript for the remainder of this post.</p>

<p>What I wanted to do: Write a simple CLJS app that runs on my Android
phone using these tools.</p>

<h3>Get HelloWorld working with PhoneGap</h3>

<p>Following <a href="http://phonegap.com/start#android">these instructions</a> will
get the Android SDK, Eclipse plugin and PhoneGap working. If you
already have the Android SDK, you&#8217;ll be able to skip most of it. I&#8217;m
most comfortable in Emacs, so I&#8217;ll be using that instead of
Eclipse. Here is the command-line command for creating your project
(the <code>-t</code> refers to your android target which you can find by doing
<code>android list avds</code>):</p>

<pre><code>$ android create project -n HelloPhoneGap -t 2 -p HelloPhoneGap -k com.phonegap.helloworld -a App
</code></pre>

<p>By the end of these instructions, you should have a copy of an app
called HelloPhoneGap on your phone which, when clicked, shows a
&#8216;Hello World&#8217; screen.</p>

<h3>Setup CLJS</h3>

<p>Follow the <a href="https://github.com/clojure/clojurescript/wiki/Quick-Start">simple
instructions</a>,
recreated here because they&#8217;re just so simple.</p>

<pre><code>$ git clone git://github.com/clojure/clojurescript.git
$ cd clojurescript
$ ./script/bootstrap
</code></pre>

<p>That&#8217;s it. The CLJS compiler and REPL are ready to work.</p>

<h3>Get HelloWorld working via HTML</h3>

<p>Follow the
<a href="https://github.com/clojure/clojurescript/wiki/Quick-Start">instructions</a>
under the heading <em>Using ClojureScript on a Web Page</em> to build a
Javascript file and associated HTML file for testing.</p>

<h3>Put CLJS and PhoneGap together</h3>

<p>OK, let&#8217;s make something a little interactive on the phone. I&#8217;m going
to build a BMI calculator that takes a person&#8217;s height and weight in
Imperial (i.e. American) units and calculates a Body Mass Index. BMI
is simply weight divided by the square of height, with units of
kg/m<super>2</super>.</p>

<p>Here&#8217;s the CLJS file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">bmi</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">height</span> <span class="p">[</span><span class="nv">feet</span> <span class="nv">inches</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">-&gt; </span><span class="nv">feet</span> <span class="p">(</span><span class="nb">* </span><span class="mi">12</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">inches</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="mf">2.54</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="mi">100</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">weight</span> <span class="p">[</span><span class="nv">lbs</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">/ </span><span class="nv">lbs</span> <span class="mf">2.2</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">bmi</span> <span class="p">[</span><span class="nv">h</span> <span class="nv">w</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">js/Math.round</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">w</span> <span class="p">(</span><span class="nb">* </span><span class="nv">h</span> <span class="nv">h</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="o">^</span><span class="ss">:export</span> <span class="nv">alertDismissed</span> <span class="p">[]</span>
</span><span class='line'>  <span class="nv">nil</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="o">^</span><span class="ss">:export</span> <span class="nv">displaybmi</span> <span class="p">[</span><span class="nv">form</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">h</span> <span class="p">(</span><span class="nf">height</span> <span class="p">(</span><span class="nf">js/parseInt</span> <span class="nv">form.f.value</span><span class="p">)</span> <span class="p">(</span><span class="nf">js/parseInt</span> <span class="nv">form.i.value</span><span class="p">))</span>
</span><span class='line'>        <span class="nv">w</span> <span class="p">(</span><span class="nf">weight</span> <span class="p">(</span><span class="nf">js/parseInt</span> <span class="nv">form.l.value</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">js/navigator.notification.alert</span> <span class="p">(</span><span class="nf">bmi</span> <span class="nv">h</span> <span class="nv">w</span><span class="p">)</span> <span class="nv">hello.alertDismissed</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Basically, we create simple functions to convert Imperial heights and
weights to metric values, calculate a BMI and then use <code>displaybmi</code> to
parse form parameters, calculate the BMI and show that result in an
Android notification popup. <code>alertDismissed</code> is a callback that gets
called when the user dismisses the notification. (I&#8217;m just discarding
the information here). Those are the only 2 functions that are needed
by the HTML file, so those are the only 2 that need the <code>:export</code>
metadata tag. <code>navigator.notification.alert</code> is a PhoneGap API call
that does the actual notification.</p>

<p>The calls prefixed by <code>js/</code> are understood by the CLJS compiler to
refer to the global JavaScript namespace. If you didn&#8217;t include that
prefix, the compiler would assume you meant a call in the local
<code>bmi</code> namespace, which would obviously fail.</p>

<p>Here&#8217;s the HTML file (in <code>HelloPhoneGap/assets/www/</code>):</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>BMI calculator<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span> <span class="na">src=</span><span class="s">&quot;phonegap-1.0.0.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span> <span class="na">src=</span><span class="s">&quot;bmi.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h1&gt;</span>BMI calculator<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;form&gt;</span>
</span><span class='line'>      Height: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;f&quot;</span> <span class="na">size=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span> ft. <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;i&quot;</span> <span class="na">size=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span> in. <span class="nt">&lt;br&gt;</span>
</span><span class='line'>      Weight: <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;l&quot;</span> <span class="na">size=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span> lbs.<span class="nt">&lt;br&gt;</span>
</span><span class='line'>      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">value=</span><span class="s">&quot;Calculate BMI&quot;</span> <span class="na">onclick=</span><span class="s">&quot;bmi.displaybmi(this.form)&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/form&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now compile the CLJS and move the compiled JS file to
<code>HelloPhoneGap/assets/www/</code></p>

<pre><code>$ ./bin/cljsc bmi.cljs '{:optimizations :simple :pretty-print true}' &gt; bmi.js
$ cp bmi.js ~/dev/HelloPhoneGap/assets/www/
</code></pre>

<p>The <code>:simple</code> value for optimizations and the <code>true</code> value for
pretty-print make it so that we can read the resulting JS file, but
can be changed to <code>:advanced</code> and <code>false</code> respectively when ready for
production.</p>

<p>Now, go back into the HelloPhoneGap Android project and compile it and
send it to the emulator (<code>C-c C-c i</code> in emacs). You should now have a
simple BMI calculator working on Android.</p>

<p><img src="/images/bmi.png" title="BMI Android Screenshot" ></p>

<h3>Next steps</h3>

<p>The promise of PhoneGap is that you could use similar HTML/Javascript
to create iOS versions as well, but I haven&#8217;t done that yet. There are
tons of API calls available on both platforms which are supposed to
give you the same access that native apps have. Using ClojureScript
means you get to use a modern functional language to create your app,
while getting access to the features that only JavaScript APIs
provide.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Vinod Kurup</span></span>

      








  


<time datetime="2011-11-12T21:39:34-05:00" pubdate data-updated="true">Nov 12<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/android/'>android</a>, <a class='category' href='/blog/categories/clojure/'>clojure</a>, <a class='category' href='/blog/categories/programming/'>programming</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="https://www.kurup.org/blog/2011/11/12/clojurescript-and-phonegap" data-via="vkurup" data-counturl="https://www.kurup.org/blog/2011/11/12/clojurescript-and-phonegap" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/09/08/fixing-wireless-on-eeepc" title="Previous Post: Fixing wireless on eeePC">&laquo; Fixing wireless on eeePC</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/11/29/factoring-large-numbers" title="Next Post: On Factoring Large Numbers">On Factoring Large Numbers &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/05/30/autovacuum-fail">Autovacuum not running</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/05/29/renaissance-man">Renaissance Man</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/28/cbv-dynamic">Using dynamic queries in a CBV</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/23/some-emacs-posts">Some Emacs Posts</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/22/pygments-py3">Pygments on Arch Linux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/21/django-test-models">How to create test models in Django</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/21/peanut-allergy-a-personal-clinical-review">Peanut Allergy, a personal clinical review</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/17/priorities-and-gtd">Priorities and GTD</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/16/gtd-again">GTD again?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/15/writing-paralysis">Writing paralysis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/09/steal-my-web-app-idea">Steal My Web App Idea</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/30/how-to-change-the-rear-tire-on-a-12-inch-bicycle">How to change the rear tire on a 12 inch bicycle</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/05/nsbrief-gets-the-best-guests">NSBrief gets the best guests</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/24/emacs-for-python-programming">Emacs for Python Programming</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/15/emacs-autocomplete-stumbles-on-yasnippet">Emacs Autocomplete stumbles on yasnippet</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/14/ive-gone-to-the-dark-side">I've gone to the dark side</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/04/avik-arrives">Avik Arrives!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/21/thoughts-on-free-will">Thoughts on Free Will</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/19/facebook-is-killing-blogging">Facebook is killing blogging</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/16/a-great-moment">A great moment</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("vkurup", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/vkurup" class="twitter-follow-button" data-show-count="true">Follow @vkurup</a>
  
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:vkurup">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "vkurup"; //id target for pinboard list
  var pinboard_count = 10; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  <a rel="license"
  href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Some rights
  reserved</a> by <a rel="author" href="https://profiles.google.com/vvkurup/" title="View my Google Profile">Vinod Kurup</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'vkurup';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://www.kurup.org/blog/2011/11/12/clojurescript-and-phonegap';
        var disqus_url = 'https://www.kurup.org/blog/2011/11/12/clojurescript-and-phonegap';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
