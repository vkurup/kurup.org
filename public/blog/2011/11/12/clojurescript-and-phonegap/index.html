<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

    
    
    
    <link href="//fonts.googleapis.com/css?family=Quattrocento:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Quattrocento+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
    
    

    
    <title>ClojureScript and PhoneGap</title>

    
    
    <link rel="stylesheet" href="/css/hugo-octopress.css">

    
    

    
    <link rel="stylesheet" href="/css/fork-awesome.min.css">
    

    
    <link href="https://kurup.org/favicon.ico" rel="icon">

    
    

    <meta name="description" content="" />
    <meta name="keywords" content="">
    <meta name="author" content="Vinod Kurup">

    
    <meta name="generator" content="Hugo 0.59.1" />

    
    

    
    
  </head>
  <body>

    
    <header role="banner">
<hgroup>
  
  <h1><a href="https://kurup.org/">Vinod Kurup</a></h1>
    <h2>Hospitalist/programmer in search of the meaning of life</h2>
</hgroup></header>

    
    <nav role="navigation">
<fieldset class="mobile-nav">
  
  <select onchange="location = this.value;">
    <option value="">Navigate…</option>
    
    <option value="https://kurup.org/">» Blog</option>
    
    <option value="https://kurup.org/about">» About Me</option>
    
    <option value="https://kurup.org/post">» Archives</option>
    
    <option value="https://kurup.org/categories">» Categories</option>
    
    <option value="https://kurup.org/medicine">» Medicine</option>
    
    <option value="https://kurup.org/running">» Running</option>
    
  </select>
</fieldset>


<ul class="main-navigation">
  
  
  
  <li><a href="https://kurup.org/" title="Blog">Blog</a></li>
  
  
  
  <li><a href="https://kurup.org/about" title="About Me" >About Me</a></li>
  
  
  
  <li><a href="https://kurup.org/post" title="Archives" >Archives</a></li>
  
  
  
  <li><a href="https://kurup.org/categories" title="Categories" >Categories</a></li>
  
  
  
  <li><a href="https://kurup.org/medicine" title="Medicine" >Medicine</a></li>
  
  
  
  <li><a href="https://kurup.org/running" title="Running" >Running</a></li>
  
  
</ul>

<ul class="subscription">
  
  
  <a href="https://kurup.org/index.xml" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss fa-lg"></i></a>
  
  
</ul>


<form action="https://www.google.com/search" method="get" target="_blank">
  <fieldset role="search">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
    <input type="hidden" name="q" value="site:https://kurup.org/" />
  </fieldset>
</form>

</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<header>
  <p class="meta">Nov 12, 2011
     - 4 minute read 
     - <a href="https://kurup.org/blog/2011/11/12/clojurescript-and-phonegap/#disqus_thread">Comments</a>

    
    
      - <a class="label" href="https://kurup.org/categories/clojure/">clojure </a><a class="label" href="https://kurup.org/categories/programming/">programming </a><a class="label" href="https://kurup.org/categories/android/">android </a>
    
  </p>
  <h1 class="entry-title">
     ClojureScript and PhoneGap 
  </h1>
</header>


        <div class="entry-content">
          
          
          
          

<p><a href="http://phonegap.com">Phonegap</a> is a tool that allows you to develop
apps in HTML5 + javascript and makes it easy to deploy them to
multiple mobile platforms, including Android and iOS.</p>

<p><a href="https://github.com/clojure/clojurescript">ClojureScript</a> is a dialect
of the awesome language, <a href="http://clojure.org">Clojure</a>, that compiles to
Javascript (after a pass through the <a href="http://code.google.com/closure/">Google Closure</a> optimizer). Because Clojure,
ClojureScript and Google Closure can be confusing terms, I&rsquo;ll use CLJS
instead of ClojureScript for the remainder of this post.</p>

<p>What I wanted to do: Write a simple CLJS app that runs on my Android
phone using these tools.</p>

<h3 id="get-helloworld-working-with-phonegap">Get HelloWorld working with PhoneGap</h3>

<p>Following <a href="http://phonegap.com/start#android">these instructions</a> will
get the Android SDK, Eclipse plugin and PhoneGap working. If you
already have the Android SDK, you&rsquo;ll be able to skip most of it. I&rsquo;m
most comfortable in Emacs, so I&rsquo;ll be using that instead of
Eclipse. Here is the command-line command for creating your project
(the <code>-t</code> refers to your android target which you can find by doing
<code>android list avds</code>):</p>

<pre><code>$ android create project -n HelloPhoneGap -t 2 -p HelloPhoneGap -k com.phonegap.helloworld -a App
</code></pre>

<p>By the end of these instructions, you should have a copy of an app
called HelloPhoneGap on your phone which, when clicked, shows a
&lsquo;Hello World&rsquo; screen.</p>

<h3 id="setup-cljs">Setup CLJS</h3>

<p>Follow the <a href="https://github.com/clojure/clojurescript/wiki/Quick-Start">simple instructions</a>,
recreated here because they&rsquo;re just so simple.</p>

<pre><code>$ git clone git://github.com/clojure/clojurescript.git
$ cd clojurescript
$ ./script/bootstrap
</code></pre>

<p>That&rsquo;s it. The CLJS compiler and REPL are ready to work.</p>

<h3 id="get-helloworld-working-via-html">Get HelloWorld working via HTML</h3>

<p>Follow the
<a href="https://github.com/clojure/clojurescript/wiki/Quick-Start">instructions</a>
under the heading <em>Using ClojureScript on a Web Page</em> to build a
Javascript file and associated HTML file for testing.</p>

<h3 id="put-cljs-and-phonegap-together">Put CLJS and PhoneGap together</h3>

<p>OK, let&rsquo;s make something a little interactive on the phone. I&rsquo;m going
to build a BMI calculator that takes a person&rsquo;s height and weight in
Imperial (i.e. American) units and calculates a Body Mass Index. BMI
is simply weight divided by the square of height, with units of
kg/m<super>2</super>.</p>

<p>Here&rsquo;s the CLJS file:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">    (<span style="color:#268bd2">ns </span><span style="color:#268bd2">bmi</span>)
    
    (<span style="color:#268bd2">defn </span><span style="color:#268bd2">height</span> [<span style="color:#268bd2">feet</span> <span style="color:#268bd2">inches</span>]
      (<span style="color:#b58900">-&gt; </span><span style="color:#268bd2">feet</span> (<span style="color:#b58900">* </span><span style="color:#2aa198">12</span>) (<span style="color:#b58900">+ </span><span style="color:#268bd2">inches</span>) (<span style="color:#b58900">* </span><span style="color:#2aa198">2.54</span>) (<span style="color:#b58900">/ </span><span style="color:#2aa198">100</span>)))
    
    (<span style="color:#268bd2">defn </span><span style="color:#268bd2">weight</span> [<span style="color:#268bd2">lbs</span>]
      (<span style="color:#b58900">/ </span><span style="color:#268bd2">lbs</span> <span style="color:#2aa198">2.2</span>))
    
    (<span style="color:#268bd2">defn </span><span style="color:#268bd2">bmi</span> [<span style="color:#268bd2">h</span> <span style="color:#268bd2">w</span>]
      (<span style="color:#268bd2">js/Math.round</span> (<span style="color:#b58900">/ </span><span style="color:#268bd2">w</span> (<span style="color:#b58900">* </span><span style="color:#268bd2">h</span> <span style="color:#268bd2">h</span>))))
    
    (<span style="color:#268bd2">defn </span><span style="color:#719e07">^</span><span style="color:#2aa198">:export</span> <span style="color:#268bd2">alertDismissed</span> []
      <span style="color:#268bd2">nil</span>)
    
    (<span style="color:#268bd2">defn </span><span style="color:#719e07">^</span><span style="color:#2aa198">:export</span> <span style="color:#268bd2">displaybmi</span> [<span style="color:#268bd2">form</span>]
      (<span style="color:#719e07">let </span>[<span style="color:#268bd2">h</span> (<span style="color:#268bd2">height</span> (<span style="color:#268bd2">js/parseInt</span> <span style="color:#268bd2">form.f.value</span>) (<span style="color:#268bd2">js/parseInt</span> <span style="color:#268bd2">form.i.value</span>))
            <span style="color:#268bd2">w</span> (<span style="color:#268bd2">weight</span> (<span style="color:#268bd2">js/parseInt</span> <span style="color:#268bd2">form.l.value</span>))]
        (<span style="color:#268bd2">js/navigator.notification.alert</span> (<span style="color:#268bd2">bmi</span> <span style="color:#268bd2">h</span> <span style="color:#268bd2">w</span>) <span style="color:#268bd2">hello.alertDismissed</span>)))</code></pre></div>
<p>Basically, we create simple functions to convert Imperial heights and
weights to metric values, calculate a BMI and then use <code>displaybmi</code> to
parse form parameters, calculate the BMI and show that result in an
Android notification popup. <code>alertDismissed</code> is a callback that gets
called when the user dismisses the notification. (I&rsquo;m just discarding
the information here). Those are the only 2 functions that are needed
by the HTML file, so those are the only 2 that need the <code>:export</code>
metadata tag. <code>navigator.notification.alert</code> is a PhoneGap API call
that does the actual notification.</p>

<p>The calls prefixed by <code>js/</code> are understood by the CLJS compiler to
refer to the global JavaScript namespace. If you didn&rsquo;t include that
prefix, the compiler would assume you meant a call in the local
<code>bmi</code> namespace, which would obviously fail.</p>

<p>Here&rsquo;s the HTML file (in <code>HelloPhoneGap/assets/www/</code>):</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#719e07">&lt;!DOCTYPE HTML&gt;</span>
&lt;<span style="color:#268bd2">html</span>&gt;
  &lt;<span style="color:#268bd2">head</span>&gt;
    &lt;<span style="color:#268bd2">title</span>&gt;BMI calculator&lt;/<span style="color:#268bd2">title</span>&gt;
    &lt;<span style="color:#268bd2">script</span> type<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;text/javascript&#34;</span> charset<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;utf-8&#34;</span> src<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;phonegap-1.0.0.js&#34;</span>&gt;&lt;/<span style="color:#268bd2">script</span>&gt;
    &lt;<span style="color:#268bd2">script</span> type<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;text/javascript&#34;</span> charset<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;utf-8&#34;</span> src<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;bmi.js&#34;</span>&gt;&lt;/<span style="color:#268bd2">script</span>&gt;
  &lt;/<span style="color:#268bd2">head</span>&gt;
  &lt;<span style="color:#268bd2">body</span>&gt;
    &lt;<span style="color:#268bd2">h1</span>&gt;BMI calculator&lt;/<span style="color:#268bd2">h1</span>&gt;

    &lt;<span style="color:#268bd2">form</span>&gt;
      Height: &lt;<span style="color:#268bd2">input</span> name<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;f&#34;</span> size<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;2&#34;</span>&gt; ft. &lt;<span style="color:#268bd2">input</span> name<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;i&#34;</span> size<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;2&#34;</span>&gt; in. &lt;<span style="color:#268bd2">br</span>&gt;
      Weight: &lt;<span style="color:#268bd2">input</span> name<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;l&#34;</span> size<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;2&#34;</span>&gt; lbs.&lt;<span style="color:#268bd2">br</span>&gt;
      &lt;<span style="color:#268bd2">input</span> type<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;button&#34;</span> value<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;Calculate BMI&#34;</span> onclick<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;bmi.displaybmi(this.form)&#34;</span>&gt;
    &lt;/<span style="color:#268bd2">form</span>&gt;
   &lt;/<span style="color:#268bd2">body</span>&gt;
&lt;/<span style="color:#268bd2">html</span>&gt;</code></pre></div>
<p>Now compile the CLJS and move the compiled JS file to
<code>HelloPhoneGap/assets/www/</code></p>

<pre><code>$ ./bin/cljsc bmi.cljs '{:optimizations :simple :pretty-print true}' &gt; bmi.js
$ cp bmi.js ~/dev/HelloPhoneGap/assets/www/
</code></pre>

<p>The <code>:simple</code> value for optimizations and the <code>true</code> value for
pretty-print make it so that we can read the resulting JS file, but
can be changed to <code>:advanced</code> and <code>false</code> respectively when ready for
production.</p>

<p>Now, go back into the HelloPhoneGap Android project and compile it and
send it to the emulator (<code>C-c C-c i</code> in emacs). You should now have a
simple BMI calculator working on Android.</p>








<span class="caption-wrapper ">
  <img class="caption" src="/images/bmi.png" title="BMI Android Screenshot" alt="BMI Android Screenshot">
  <span class="caption-text">BMI Android Screenshot</span>
</span>


<h3 id="next-steps">Next steps</h3>

<p>The promise of PhoneGap is that you could use similar HTML/Javascript
to create iOS versions as well, but I haven&rsquo;t done that yet. There are
tons of API calls available on both platforms which are supposed to
give you the same access that native apps have. Using ClojureScript
means you get to use a modern functional language to create your app,
while getting access to the features that only JavaScript APIs
provide.</p>

        </div>
        

<footer>
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn">Vinod Kurup</span></span>
    
    <time>Nov 12, 2011</time>
    
    </span>
  </p>

  

  <p class="meta">
    
        <a class="basic-alignment left" href="https://kurup.org/blog/2011/09/08/fixing-wireless-on-eeepc/" title="Fixing wireless on eeePC">Fixing wireless on eeePC</a>
    

    
      <a class="basic-alignment right" href="https://kurup.org/blog/2011/11/29/on-factoring-large-numbers/" title="On Factoring Large Numbers">On Factoring Large Numbers</a>
    
  </p>
  
    
      <div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
      
      
      
      if (window.location.hostname == "localhost")
          return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'vkurup';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
  
</footer>

      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    

    <p>
      
    </p>
  </section>

  

  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" href="https://github.com/vkurup/" title="https://github.com/vkurup/"><i class="fa fa-github fa-3x"></i></a>
      
      
      <a target="_blank" href="https://twitter.com/vkurup/" title="https://twitter.com/vkurup/"><i class="fa fa-twitter fa-3x"></i></a>
      
      <a target="_blank" href="https://keybase.io/vkurup/" title="https://keybase.io/vkurup/"><i class="fa fa-keybase fa-3x"></i></a> 
      
      
      <a target="_blank" href="https://stackoverflow.com/users/347942" title="https://stackoverflow.com/users/347942"><i class="fa fa-stack-overflow fa-3x"></i></a>
      
      
      
      
      

      
      
    </li>
  </ul>

  

  

  
  
  
  
  <section class="even">
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      
      
      
      <li class="post">
        <a href="/blog/2019/11/17/hugo/">Hugo</a>
      </li>
      
      
      
      
      
      <li class="post">
        <a href="/blog/2019/04/08/avik-730/">Avik 7:30</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2018/12/20/triangle-race-series/">Triangle Race Series</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2018/12/02/my-nest-journey/">My Nest Journey</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2018/09/23/composting/">Composting</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2018/09/22/starting-a-garden/">Starting a garden</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2018/05/31/history-of-indian-civilization/">History of Indian Civilization</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2018/05/30/autovacuum-not-running/">Autovacuum not running</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2018/05/29/renaissance-man/">Renaissance Man</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2014/07/28/using-dynamic-queries-in-a-cbv/">Using dynamic queries in a CBV</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2014/07/23/some-emacs-posts/">Some Emacs Posts</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2014/07/22/pygments-on-arch-linux/">Pygments on Arch Linux</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2014/07/21/how-to-create-test-models-in-django/">How to create test models in Django</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2013/01/21/peanut-allergy-a-personal-clinical-review/">Peanut Allergy, a personal clinical review</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2013/01/17/priorities-and-gtd/">Priorities and GTD</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2013/01/16/gtd-again/">GTD again?</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2013/01/15/writing-paralysis/">Writing paralysis</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2013/01/09/steal-my-web-app-idea/">Steal My Web App Idea</a>
      </li>
      
      
      
      <li class="post">
        <a href="/blog/2012/12/30/how-to-change-the-rear-tire-on-a-12-inch-bicycle/">How to change the rear tire on a 12 inch bicycle</a>
      </li>
      
      
    </ul>
  </section>
  
  

  <section class="odd">
    <h1>My Pinboard</h1>
    <ul id="pinboard_linkroll">Fetching linkroll...</ul>
    <p><a href="http://pinboard.in/u:vkurup">My Pinboard Bookmarks &raquo;</a></p>
  </section>
  <script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; 
  var pinboard_user = "vkurup"; 
  var pinboard_count = 10; 
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/js/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
  </script>

</aside>

  </div>
</div>

    <footer role="contentinfo">
      <p>Copyright &copy; 2019 Vinod Kurup - <a href="https://kurup.org/license/">License</a> -
        <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and <a target="_blank" href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
      </p>
    </footer>

    
    
    

    
      <script>
        var _gaq=[['_setAccount','UA-79447-1'],['_trackPageview']];
        (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));
      </script>
    
  </body>
</html>

