<!DOCTYPE HTML> 
<html>
   <head>
   <meta charset=utf-8> 
   <title>Creating a Blog Application using the OpenACS Content Repository &larr; </title>
   <meta name="author" content="Vinod Kurup" />

  <link rel="openid.server" href="http://www.myopenid.com/server" />
  <link rel="openid.delegate" href="http://vkurup.myopenid.com/" />
  <link rel="openid2.local_id" href="http://vkurup.myopenid.com" />
  <link rel="openid2.provider" href="http://www.myopenid.com/server" />
  <meta http-equiv="X-XRDS-Location" content="http://www.myopenid.com/xrds?username=vkurup.myopenid.com" />

	
	
	
  	<link rel="alternate" type="application/atom+xml" href="atom.xml" title="RSS feed" />
	

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/files/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/files/css/screen.css" type="text/css" />

</head>
<body id="">
<div id="site">

  <div id="header">
	<h1>
	<a href="/" title="My Personal Site">Vinod Kurup</a>
</h1>
<ul class="nav">
  <li><a class="home" href="/">Home</a></li>
  <li><a class="medicine" href="/medicine">Medicine</a></li>
  <li><a class="feed" href="/blog/atom.xml">Feed</a></li>
</ul>

  </div>

  <div id="page">
	
<h1 class="emphnext">Creating a Blog Application using the OpenACS Content Repository</h1>

<p>I created a very simple blog application using the OpenACS Content Repository (CR). When I say simple, I mean simple, probably to the point of being useless. I just wanted to try writing something as quickly as possible using the CR. Here&#8217;s a quick run-through of the code, in case it might help someone else understand how to use the CR. I&#8217;m not including much commentary; email me (or comment) if you&#8217;d like me to expound more.</p>

<h4 id='bloginfo'>blog.info</h4>
<div class='highlight'><pre><span class='cp'>&lt;?xml version=&quot;1.0&quot;?&gt;</span> 
<span class='c'>&lt;!-- Generated by the OpenACS Package Manager --&gt;</span>  
<span class='nt'>&lt;package</span> <span class='na'>key=</span><span class='s'>&quot;blog&quot;</span> <span class='na'>url=</span><span class='s'>&quot;http://openacs.org/repository/apm/packages/blog&quot;</span> <span class='na'>type=</span><span class='s'>&quot;apm_application&quot;</span><span class='nt'>&gt;</span>   
  <span class='nt'>&lt;package-name&gt;</span>Blog<span class='nt'>&lt;/package-name&gt;</span>
  <span class='nt'>&lt;pretty-plural&gt;</span>Blogs<span class='nt'>&lt;/pretty-plural&gt;</span>
  <span class='nt'>&lt;initial-install-p&gt;</span>f<span class='nt'>&lt;/initial-install-p&gt;</span>
  <span class='nt'>&lt;singleton-p&gt;</span>f<span class='nt'>&lt;/singleton-p&gt;</span>
  <span class='nt'>&lt;version</span> <span class='na'>name=</span><span class='s'>&quot;0.1d&quot;</span> <span class='na'>url=</span><span class='s'>&quot;http://openacs.org/repository/download/apm/blog-0.1d.apm&quot;</span><span class='nt'>&gt;</span>
    <span class='nt'>&lt;owner</span> <span class='na'>url=</span><span class='s'>&quot;mailto:admin@localhost&quot;</span><span class='nt'>&gt;</span>Admin User<span class='nt'>&lt;/owner&gt;</span>
    <span class='nt'>&lt;summary&gt;</span>A blog application.<span class='nt'>&lt;/summary&gt;</span>
    <span class='nt'>&lt;description</span> <span class='na'>format=</span><span class='s'>&quot;text/html&quot;</span><span class='nt'>&gt;</span>A simple Blog application using the Content Repository.<span class='nt'>&lt;/description&gt;</span>
    <span class='nt'>&lt;maturity&gt;</span>0<span class='nt'>&lt;/maturity&gt;</span>
    <span class='nt'>&lt;provides</span> <span class='na'>url=</span><span class='s'>&quot;blog&quot;</span> <span class='na'>version=</span><span class='s'>&quot;0.1d&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;requires</span> <span class='na'>url=</span><span class='s'>&quot;acs-content-repository&quot;</span> <span class='na'>version=</span><span class='s'>&quot;5.2.2&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;callbacks&gt;</span>
      <span class='nt'>&lt;callback</span> <span class='na'>type=</span><span class='s'>&quot;after-install&quot;</span>  <span class='na'>proc=</span><span class='s'>&quot;blog::apm::after_install&quot;</span><span class='nt'>/&gt;</span>
      <span class='nt'>&lt;callback</span> <span class='na'>type=</span><span class='s'>&quot;after-instantiate&quot;</span>  <span class='na'>proc=</span><span class='s'>&quot;blog::apm::after_instantiate&quot;</span><span class='nt'>/&gt;</span>
      <span class='nt'>&lt;callback</span> <span class='na'>type=</span><span class='s'>&quot;before-uninstantiate&quot;</span>  <span class='na'>proc=</span><span class='s'>&quot;blog::apm::before_uninstantiate&quot;</span><span class='nt'>/&gt;</span>
      <span class='nt'>&lt;callback</span> <span class='na'>type=</span><span class='s'>&quot;before-uninstall&quot;</span>  <span class='na'>proc=</span><span class='s'>&quot;blog::apm::before_uninstall&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;/callbacks&gt;</span>
    <span class='nt'>&lt;parameters&gt;</span>
      <span class='c'>&lt;!-- No version parameters --&gt;</span>
    <span class='nt'>&lt;/parameters&gt;</span>
  <span class='nt'>&lt;/version&gt;</span>
<span class='nt'>&lt;/package&gt;</span>
</pre>
</div>
<h4 id='tclblogapmprocstcl'>tcl/blog-apm-procs.tcl</h4>
<div class='highlight'><pre><span class='k'>namespace</span> eval blog::apm <span class='k'>{}</span>

<span class='nv'>ad_proc</span> <span class='o'>-</span>private blog::apm::after_install <span class='k'>{}</span> <span class='k'>{</span>
    <span class='nv'>Install</span> the blog datamodel. 
<span class='k'>}</span> <span class='k'>{</span>     
    <span class='nv'>content</span><span class='o'>::</span>type::new <span class='o'>-</span>content_type blog_post <span class='err'>\</span>
        <span class='nv'>-pretty_name</span> <span class='s2'>&quot;Blog Post&quot;</span> <span class='err'>\</span>
        <span class='nv'>-pretty_plural</span> <span class='s2'>&quot;Blog Posts&quot;</span> <span class='err'>\</span>
        <span class='nv'>-table_name</span> <span class='s2'>&quot;cr_blog_posts&quot;</span> <span class='err'>\</span>
        <span class='nv'>-id_column</span> <span class='s2'>&quot;post_id&quot;</span> 
<span class='k'>}</span>  

ad_proc <span class='o'>-</span>private blog::apm::after_instantiate <span class='k'>{</span> <span class='nv'>-package_id</span> <span class='k'>}</span> <span class='k'>{</span>
    <span class='nv'>Setup</span> one instance of a blog. Creates a content folder and associate
    <span class='nv'>blog_posts</span> with it. 
<span class='k'>}</span> <span class='k'>{</span>
    <span class='k'>set</span> folder_id <span class='k'>[</span><span class='nv'>content</span><span class='o'>::</span>folder::new <span class='err'>\</span>
                       <span class='nv'>-name</span> <span class='nv'>$package_id</span> <span class='err'>\</span>
                       <span class='nv'>-label</span> <span class='s2'>&quot;Blog Folder $package_id&quot;</span> <span class='err'>\</span>
                       <span class='nv'>-package_id</span> <span class='nv'>$package_id</span> <span class='err'>\</span>
                       <span class='nv'>-context_id</span> <span class='nv'>$package_id</span><span class='k'>]</span>

    <span class='nv'>content</span><span class='o'>::</span>folder::register_content_type <span class='err'>\</span>
        <span class='nv'>-folder_id</span> <span class='nv'>$folder_id</span> <span class='err'>\</span>
        <span class='nv'>-content_type</span> <span class='s2'>&quot;blog_post&quot;</span> <span class='err'>\</span>
        <span class='nv'>-include_subtypes</span> <span class='s2'>&quot;t&quot;</span> 
<span class='k'>}</span>  

ad_proc <span class='o'>-</span>private blog::apm::before_uninstantiate <span class='k'>{</span> <span class='nv'>-package_id</span> <span class='k'>}</span> <span class='k'>{</span>
    <span class='nv'>Remove</span> <span class='mi'>1</span> instance of blog application. 
<span class='k'>}</span> <span class='k'>{</span>
    <span class='k'>set</span> folder_id <span class='k'>[</span><span class='nv'>blog</span><span class='o'>::</span>folder_id <span class='nv'>$package_id</span><span class='k'>]</span>
    <span class='nv'>content</span><span class='o'>::</span>folder::delete <span class='o'>-</span>folder_id <span class='nv'>$folder_id</span> <span class='o'>-</span>cascade_p t
    <span class='nv'>content</span><span class='o'>::</span>type::delete <span class='o'>-</span>content_type blog_post <span class='err'>\</span>
        <span class='nv'>-drop_children_p</span> t <span class='err'>\</span>
        <span class='nv'>-drop_table_p</span> t 
<span class='k'>}</span>  

ad_proc <span class='o'>-</span>private blog::apm::before_uninstall <span class='k'>{}</span> <span class='k'>{</span>
    <span class='nv'>Drop</span> the application. 
<span class='k'>}</span> <span class='k'>{</span>
    <span class='nv'>content</span><span class='o'>::</span>type::delete <span class='o'>-</span>content_type blog_post <span class='err'>\</span>
        <span class='nv'>-drop_children_p</span> t <span class='err'>\</span>
        <span class='nv'>-drop_table_p</span> t 
<span class='k'>}</span> 
</pre>
</div>
<h4 id='tclblogprocstcl'>tcl/blog-procs.tcl</h4>
<div class='highlight'><pre><span class='k'>namespace</span> eval blog <span class='k'>{}</span>

<span class='nv'>ad_proc</span> <span class='o'>-</span>public blog::folder_id <span class='k'>{</span><span class='nv'>package_id</span><span class='k'>}</span> <span class='k'>{</span>
    <span class='nv'>Return</span> the CR folder_id associated with this package_id
    <span class='err'>@</span><span class='nv'>param</span> package_id Current package_id 
<span class='k'>}</span> <span class='k'>{</span>
    <span class='k'>return</span> <span class='k'>[</span><span class='nv'>db_string</span> get_folder_id <span class='s2'>&quot;select folder_id from cr_folders where package_id=:package_id&quot;</span><span class='k'>]</span> 
<span class='k'>}</span>
</pre>
</div>
<h4 id='wwwindextcl'>www/index.tcl</h4>
<div class='highlight'><pre><span class='nv'>ad_page_contract</span> <span class='k'>{</span>
    <span class='nv'>List</span> posts
    <span class='err'>@</span><span class='nv'>author</span> Vinod Kurup <span class='k'>[</span><span class='nv'>vinod</span><span class='err'>@</span>kurup.com<span class='k'>]</span>
    <span class='err'>@</span><span class='nv'>creation-date</span> Tue Feb <span class='mi'>14</span> <span class='mi'>20</span><span class='o'>:</span><span class='mi'>56</span><span class='o'>:</span><span class='mi'>24</span> <span class='mi'>2006</span>
    <span class='err'>@</span><span class='nv'>cvs-id</span> <span class='nv'>$Id:</span><span class='err'>$</span> 
<span class='k'>}</span> <span class='k'>{</span> 
<span class='k'>}</span> <span class='k'>{</span>
    <span class='k'>set</span> package_id <span class='k'>[</span><span class='nv'>ad_conn</span> package_id<span class='k'>]</span>
    <span class='nv'>db_multirow</span> posts posts <span class='s2'>&quot;</span>
<span class='s2'>    select i.item_id,</span>
<span class='s2'>           r.title,</span>
<span class='s2'>           r.content,</span>
<span class='s2'>           to_char(o.creation_date,&#39;YYYY-MM-DD HH24:MI:SS&#39;) as creation_date,</span>
<span class='s2'>           o.creation_user</span>
<span class='s2'>     from cr_blog_posts p, cr_items i, cr_revisions r, acs_objects o</span>
<span class='s2'>    where i.item_id=o.object_id</span>
<span class='s2'>      and p.post_id=r.revision_id</span>
<span class='s2'>      and o.package_id=:package_id</span>
<span class='s2'>       and i.live_revision=p.post_id</span>
<span class='s2'>    order by creation_date desc&quot;</span>
<span class='k'>}</span> 
</pre>
</div>
<h4 id='wwwindexadp'>www/index.adp</h4>
<div class='highlight'><pre><span class='nt'>&lt;master&gt;</span>
  <span class='nt'>&lt;p&gt;&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;post/ae&quot;</span><span class='nt'>&gt;</span>Add Post<span class='nt'>&lt;/a&gt;&lt;/p&gt;</span>
  <span class='nt'>&lt;multiple</span> <span class='na'>name=</span><span class='s'>&quot;posts&quot;</span><span class='nt'>&gt;</span>
    <span class='nt'>&lt;include</span> <span class='na'>src=</span><span class='s'>&quot;../lib/one-post&quot;</span>
             <span class='na'>item_id=</span><span class='s'>&quot;@posts.item_id@&quot;</span>
             <span class='na'>title=</span><span class='s'>&quot;@posts.title@&quot;</span>
             <span class='na'>content=</span><span class='s'>&quot;@posts.content@&quot;</span>
             <span class='na'>creation_user=</span><span class='s'>&quot;@posts.creation_user@&quot;</span>
             <span class='na'>creation_date=</span><span class='s'>&quot;@posts.creation_date@&quot;</span>
             <span class='nt'>/&gt;</span>
  <span class='nt'>&lt;/multiple&gt;</span>
</pre>
</div>
<h4 id='wwwpostaetcl'>www/post/ae.tcl</h4>
<div class='highlight'><pre><span class='nv'>ad_page_contract</span> <span class='k'>{</span>
      <span class='nv'>Add</span> or edit a post
      <span class='err'>@</span><span class='nv'>author</span> Vinod Kurup <span class='k'>[</span><span class='nv'>vinod</span><span class='err'>@</span>kurup.com<span class='k'>]</span>
      <span class='err'>@</span><span class='nv'>creation-date</span> Tue Feb <span class='mi'>14</span> <span class='mi'>20</span><span class='o'>:</span><span class='mi'>39</span><span class='o'>:</span><span class='mi'>39</span> <span class='mi'>2006</span>
      <span class='err'>@</span><span class='nv'>cvs-id</span> <span class='nv'>$Id:</span><span class='err'>$</span> 
<span class='k'>}</span> <span class='k'>{</span>
    <span class='nv'>item_id</span><span class='o'>:</span>integer<span class='err'>,</span>optional 
<span class='k'>}</span> <span class='k'>{</span>
    <span class='k'>set</span> package_id <span class='k'>[</span><span class='nv'>ad_conn</span> package_id<span class='k'>]</span>
    <span class='k'>set</span> user_id <span class='k'>[</span><span class='nv'>ad_conn</span> user_id<span class='k'>]</span>
    <span class='k'>set</span> ip_addr <span class='k'>[</span><span class='nv'>ad_conn</span> peeraddr<span class='k'>]</span>
    <span class='nv'>permission</span><span class='o'>::</span>require_permission <span class='o'>-</span>object_id <span class='nv'>$package_id</span> <span class='o'>-</span>privilege write
    <span class='k'>set</span> context <span class='k'>[</span><span class='nb'>list</span> <span class='s2'>&quot;Add/Edit Post&quot;</span><span class='k'>]</span>

    <span class='nv'>ad_form</span> <span class='o'>-</span>name add_post <span class='o'>-</span>form <span class='k'>{</span>
        <span class='nv'>item_id</span><span class='o'>:</span>key<span class='k'>(</span><span class='nv'>t_acs_object_id_seq</span><span class='k'>)</span>
        <span class='nv'>title</span><span class='o'>:</span>text<span class='k'>(</span><span class='nv'>text</span><span class='k'>)</span>
        <span class='nv'>content</span><span class='o'>:</span>text<span class='k'>(</span><span class='nv'>textarea</span><span class='k'>)</span> 
    <span class='k'>}</span> <span class='o'>-</span>select_query <span class='k'>{</span>
        <span class='nv'>select</span> r.title<span class='err'>,</span> r.content
        <span class='nv'>from</span> cr_items i<span class='err'>,</span> cr_revisions r
        <span class='nv'>where</span> i.item_id<span class='err'>=</span><span class='o'>:</span>item_id
        <span class='nv'>and</span> i.live_revision<span class='err'>=</span>r.revision_id 
    <span class='k'>}</span> <span class='o'>-</span>edit_data <span class='k'>{</span>
        <span class='nv'>content</span><span class='o'>::</span>revision::new <span class='o'>-</span>item_id <span class='nv'>$item_id</span> <span class='err'>\</span>
            <span class='nv'>-title</span> <span class='nv'>$title</span> <span class='err'>\</span>
            <span class='nv'>-content</span> <span class='nv'>$content</span> <span class='err'>\</span>
            <span class='nv'>-package_id</span> <span class='nv'>$package_id</span> <span class='err'>\</span>
            <span class='nv'>-is_live</span> t

        <span class='nv'>ns_returnredirect</span> .. 
    <span class='k'>}</span> <span class='o'>-</span>new_data <span class='k'>{</span>
        <span class='nv'>content</span><span class='o'>::</span>item::new <span class='o'>-</span>name <span class='s2'>&quot;Post $item_id&quot;</span> <span class='err'>\</span>
            <span class='nv'>-item_id</span> <span class='nv'>$item_id</span> <span class='err'>\</span>
            <span class='nv'>-creation_user</span> <span class='nv'>$user_id</span> <span class='err'>\</span>
            <span class='nv'>-text</span> <span class='nv'>$content</span> <span class='err'>\</span>
            <span class='nv'>-package_id</span> <span class='nv'>$package_id</span> <span class='err'>\</span>
            <span class='nv'>-parent_id</span> <span class='k'>[</span><span class='nv'>blog</span><span class='o'>::</span>folder_id <span class='nv'>$package_id</span><span class='k'>]</span> <span class='err'>\</span>
            <span class='nv'>-creation_ip</span> <span class='nv'>$ip_addr</span> <span class='err'>\</span>
            <span class='nv'>-content_type</span> <span class='s2'>&quot;blog_post&quot;</span> <span class='err'>\</span>
            <span class='nv'>-title</span> <span class='nv'>$title</span>

        <span class='nv'>ns_returnredirect</span> .. 
    <span class='k'>}</span>
</pre>
</div>
<h4 id='wwwpostaeadp'>www/post/ae.adp</h4>
<div class='highlight'><pre><span class='nt'>&lt;master&gt;</span>
  <span class='nt'>&lt;property</span> <span class='na'>name=</span><span class='s'>&quot;title&quot;</span><span class='nt'>&gt;</span>Add/Edit Post<span class='nt'>&lt;/property&gt;</span>
  <span class='nt'>&lt;property</span> <span class='na'>name=</span><span class='s'>&quot;context&quot;</span><span class='nt'>&gt;</span>@context;noquote@<span class='nt'>&lt;/property&gt;</span>
  
  <span class='nt'>&lt;formtemplate</span> <span class='na'>id=</span><span class='s'>&quot;add_post&quot;</span><span class='nt'>&gt;&lt;/formtemplate&gt;</span>
</pre>
</div>
<h4 id='wwwpostdeltcl'>www/post/del.tcl</h4>
<div class='highlight'><pre><span class='nv'>ad_page_contract</span> <span class='k'>{</span>
    <span class='nv'>Delete</span> a post
    <span class='err'>@</span><span class='nv'>author</span> Vinod Kurup <span class='k'>[</span><span class='nv'>vinod</span><span class='err'>@</span>kurup.com<span class='k'>]</span>
    <span class='err'>@</span><span class='nv'>creation-date</span> Tue Feb <span class='mi'>14</span> <span class='mi'>22</span><span class='o'>:</span><span class='mi'>49</span><span class='o'>:</span><span class='mi'>11</span> <span class='mi'>2006</span>
    <span class='err'>@</span><span class='nv'>cvs-id</span> <span class='nv'>$Id:</span><span class='err'>$</span> 
<span class='k'>}</span> <span class='k'>{</span>
    <span class='nv'>item_id</span><span class='o'>:</span>integer 
<span class='k'>}</span> <span class='k'>{</span>
    <span class='nv'>permission</span><span class='o'>::</span>require_permission <span class='o'>-</span>object_id <span class='nv'>$item_id</span> <span class='o'>-</span>privilege write
    <span class='nv'>content</span><span class='o'>::</span>item::delete <span class='o'>-</span>item_id <span class='nv'>$item_id</span>
    <span class='nv'>ns_returnredirect</span> .. 
<span class='k'>}</span>
</pre>
</div>
<h4 id='wwwpostviewtcl'>www/post/view.tcl</h4>
<div class='highlight'><pre><span class='nv'>ad_page_contract</span> <span class='k'>{</span>
    <span class='nv'>View</span> one post
    <span class='err'>@</span><span class='nv'>author</span> Vinod Kurup <span class='k'>[</span><span class='nv'>vinod</span><span class='err'>@</span>kurup.com<span class='k'>]</span>
    <span class='err'>@</span><span class='nv'>creation-date</span> Wed Feb <span class='mi'>15</span> <span class='mi'>20</span><span class='o'>:</span><span class='mi'>24</span><span class='o'>:</span><span class='mi'>32</span> <span class='mi'>2006</span>
    <span class='err'>@</span><span class='nv'>cvs-id</span> <span class='nv'>$Id:</span><span class='err'>$</span> 
<span class='k'>}</span> <span class='k'>{</span>
    <span class='nv'>item_id</span><span class='o'>:</span>integer 
<span class='k'>}</span> <span class='k'>{</span>
    <span class='k'>set</span> package_id <span class='k'>[</span><span class='nv'>ad_conn</span> package_id<span class='k'>]</span> 
    set package_url <span class='k'>[</span><span class='nv'>ad_conn</span> package_url<span class='k'>]</span>
    <span class='nv'>db_0or1row</span> post <span class='s2'>&quot; select i.item_id,</span>
<span class='s2'>        r.title,</span>
<span class='s2'>        r.content,</span>
<span class='s2'>        to_char(o.creation_date,&#39;YYYY-MM-DD HH24:MI:SS&#39;) as creation_date,</span>
<span class='s2'>        o.creation_user</span>
<span class='s2'>   from cr_blog_posts p, cr_items i, cr_revisions r, acs_objects o</span>
<span class='s2'>  where i.item_id=o.object_id</span>
<span class='s2'>    and p.post_id=r.revision_id</span>
<span class='s2'>    and o.package_id=:package_id</span>
<span class='s2'>     and i.live_revision=p.post_id</span>
<span class='s2'>    and i.item_id=:item_id&quot;</span>

    <span class='k'>set</span> context <span class='k'>[</span><span class='nb'>list</span> <span class='nv'>$title</span><span class='k'>]</span> 
</pre>
</div>
<h4 id='wwwpostviewadp'>www/post/view.adp</h4>
<div class='highlight'><pre><span class='nt'>&lt;master&gt;</span>
  <span class='nt'>&lt;property</span> <span class='na'>name=</span><span class='s'>&quot;context&quot;</span><span class='nt'>&gt;</span>@context;noquote@<span class='nt'>&lt;/property&gt;</span>
  <span class='nt'>&lt;property</span> <span class='na'>name=</span><span class='s'>&quot;title&quot;</span><span class='nt'>&gt;</span>@title@<span class='nt'>&lt;/property&gt;</span>

  <span class='nt'>&lt;include</span> <span class='na'>src=</span><span class='s'>&quot;../../lib/one-post&quot;</span>
           <span class='na'>item_id=</span><span class='s'>&quot;@item_id@&quot;</span>
           <span class='na'>title=</span><span class='s'>&quot;@title@&quot;</span>
           <span class='na'>content=</span><span class='s'>&quot;@content@&quot;</span>
           <span class='na'>creation_user=</span><span class='s'>&quot;@creation_user@&quot;</span>
           <span class='na'>creation_date=</span><span class='s'>&quot;@creation_date@&quot;</span>
           <span class='nt'>/&gt;</span>
</pre>
</div>
<h4 id='liboneposttcl'>lib/one-post.tcl</h4>
<div class='highlight'><pre><span class='k'>set</span> package_url <span class='k'>[</span><span class='nv'>ad_conn</span> package_url<span class='k'>]</span>
<span class='k'>set</span> now <span class='k'>[</span><span class='nb'>clock</span> format <span class='k'>[</span><span class='nb'>clock</span> seconds<span class='k'>]</span> <span class='o'>-</span>format <span class='s2'>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class='k'>]</span>
<span class='k'>set</span> creation_date_pretty <span class='k'>[</span><span class='nv'>util</span><span class='o'>::</span>age_pretty <span class='err'>\</span>
                              <span class='nv'>-timestamp_ansi</span> <span class='nv'>$creation_date</span> <span class='err'>\</span>
                              <span class='nv'>-sysdate_ansi</span> <span class='nv'>$now</span><span class='k'>]</span>
<span class='k'>set</span> author <span class='k'>[</span><span class='nv'>acs_community_member_link</span> <span class='o'>-</span>user_id <span class='nv'>$creation_user</span><span class='k'>]</span>
<span class='k'>set</span> write_p <span class='k'>[</span><span class='nv'>permission</span><span class='o'>::</span>permission_p <span class='o'>-</span>object_id <span class='nv'>$item_id</span> <span class='o'>-</span>privilege write<span class='k'>]</span>
<span class='k'>set</span> perm_url <span class='k'>[</span><span class='nv'>export_vars</span> <span class='o'>-</span>base <span class='s2'>&quot;${package_url}post/view&quot;</span> <span class='k'>{</span><span class='nv'>item_id</span><span class='k'>}]</span>
</pre>
</div>
<h4 id='libonepostadp'>lib/one-post.adp</h4>
<div class='highlight'><pre><span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&quot;post&quot;</span><span class='nt'>&gt;</span>
  <span class='nt'>&lt;h2&gt;&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;@perm_url@&quot;</span><span class='nt'>&gt;</span>@title@<span class='nt'>&lt;/a&gt;&lt;/h2&gt;</span>
  <span class='nt'>&lt;p</span> <span class='na'>class=</span><span class='s'>&quot;byline&quot;</span><span class='nt'>&gt;</span>
    Posted by @author;noquote@
    <span class='nt'>&lt;span</span> <span class='na'>class=</span><span class='s'>&quot;date&quot;</span><span class='nt'>&gt;</span>@creation_date_pretty@<span class='nt'>&lt;/span&gt;</span>
  <span class='nt'>&lt;/p&gt;</span>
  <span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&quot;content&quot;</span><span class='nt'>&gt;</span>
    @content;noquote@
  <span class='nt'>&lt;/div&gt;</span>
  <span class='nt'>&lt;p</span> <span class='na'>class=</span><span class='s'>&quot;actions&quot;</span><span class='nt'>&gt;</span>
    <span class='nt'>&lt;if</span> <span class='err'>@write_p@</span><span class='nt'>&gt;</span>
      <span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;@package_url@post/ae?item_id=@item_id@&quot;</span><span class='nt'>&gt;</span>Edit<span class='nt'>&lt;/a&gt;</span> |
      <span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;@package_url@post/del?item_id=@item_id@&quot;</span><span class='nt'>&gt;</span>Delete<span class='nt'>&lt;/a&gt;</span>
    <span class='nt'>&lt;/if&gt;</span>
  <span class='nt'>&lt;/p&gt;</span>
<span class='nt'>&lt;/div&gt;</span>
</pre>
</div>
<h4 id='notes'>Notes</h4>

<p>You&#8217;ll notice that there are no SQL datamodel files. Since I&#8217;m using the CR, all of the datamodel is created by using the CR TCL API (specifically content::type::new). This package is subsite aware meaning you can install apps on multiple subsites and the data in each subsite will remain isolated from other subsites. It should uninstall itself cleanly since I&#8217;ve written callbacks for before-uninstantiate and before-uninstall.</p>

<p>Like I said, this is very simplistic. You can create, read, update and delete posts, but that&#8217;s about it. No commenting. No tags or categories. No RSS feeds. No search. But, since we&#8217;ve used the CR as our base, I think it would be very easy to extend the app to do all those things. I&#8217;m going to work on that, just for fun, of course. Thanks to <a href='http://www.thedesignexperience.org'>Dave Bauer</a> for writing the TCL interface to the CR and for writing the wiki package which made me see the light about the benefits of using the CR.</p>

<address class="signature">
  <span class="author">&nbsp;</span>
  <span class="date">16 February 2006</span>
  <span class="tags"><a href="http://www.google.com/search?q=blog+site:www.kurup.org" rel="tag">blog</a>  | <a href="http://www.google.com/search?q=cr+site:www.kurup.org" rel="tag">cr</a>  | <a href="http://www.google.com/search?q=openacs+site:www.kurup.org" rel="tag">openacs</a>  | <a href="http://www.google.com/search?q=programming+site:www.kurup.org" rel="tag">programming</a>  | <a href="http://www.google.com/search?q=web+site:www.kurup.org" rel="tag">web</a>  </span>
</address>

<!-- Discus Comments -->
<div id="disqus_thread"></div>

<!-- Enable Disqus comments -->
<script type="text/javascript">
    var disqus_developer = "0";
    var disqus_iframe_css = "http://www.kurup.org/blog/files/css/screen.css";
    var disqus_title = "Creating a Blog Application using the OpenACS Content Repository";
</script>
<script type="text/javascript" src="http://disqus.com/forums/vkurup/embed.js"></script>

<noscript>
		<a href="http://vkurup.disqus.com/?url=ref">View the discussion thread.</a>
</noscript>

<!-- DISQUS CODE -->
<script type="text/javascript">
//<![CDATA[
(function() {
	var links = document.getElementsByTagName('a');
	var query = '?';
	for(var i = 0; i < links.length; i++) {
	if(links[i].href.indexOf('#disqus_thread') >= 0) {
		query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
	}
	}
	document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/vkurup/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script>

  </div>
  
  <div id="footer">
	<address>
		<span class="copyright">
			Design by 
			<a href="http://mark.reid.name">Mark Reid</a>, Content
			by <a href="mailto:vinod@kurup.com">Vinod Kurup</a>
			<br/>
			(<a rel="licence" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Some rights reserved</a>)			
		</span>
		<span class="engine">
			Powered by 
			<a href="http://github.com/mojombo/jekyll/" title="A static, minimalist CMS">Jekyll</a>
		</span>
	</address>
  </div>
</div>

<!-- Google Analytics -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-79447-1");
pageTracker._trackPageview();
} catch(err) {}
</script>
</body>
</html>
